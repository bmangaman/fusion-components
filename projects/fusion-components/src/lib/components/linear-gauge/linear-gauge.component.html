
<div class="fusion-ui-linear-gauge" [ngClass]="classes">

  <div class="fusion-ui-linear-gauge__title">
    <i *ngIf="level !== FusionUiStatusLevel.BASE"
      class="fusion-ui-linear-gauge__title-icon mdi"
      [ngClass]="{
        'mdi-check-circle' : level === FusionUiStatusLevel.NORMAL,
        'mdi-alert' : level === FusionUiStatusLevel.WARNING,
        'mdi-alert-circle' : level === FusionUiStatusLevel.ERROR,
        'mdi-close-circle' : level === FusionUiStatusLevel.CRITICAL
      }">
    </i>
    <h3 class="fusion-ui-linear-gauge__title-text">{{ translations?.title }}</h3>
  </div>

  <div class="fusion-ui-linear-gauge__bar-container">
    <div class="fusion-ui-linear-gauge__bar">

      <button
        *ngFor="let threshold of thresholds"
        class="fusion-ui-linear-gauge__threshold"
        [ngStyle]="{ 'left': threshold?.value | percentage: maxValue:minValue | percent }"
        [ngClass]="{
          'fusion-ui-linear-gauge__threshold--normal' : threshold?.level === FusionUiStatusLevel.NORMAL,
          'fusion-ui-linear-gauge__threshold--warning' : threshold?.level === FusionUiStatusLevel.WARNING,
          'fusion-ui-linear-gauge__threshold--error' : threshold?.level === FusionUiStatusLevel.ERROR,
          'fusion-ui-linear-gauge__threshold--critical' : threshold?.level === FusionUiStatusLevel.CRITICAL,
          'fusion-ui-linear-gauge__threshold--passed' : threshold?.passed
        }"
        fusionUiTooltip
        [attr.aria-label]="threshold?.level | getFusionUiStatusLevelText: translations:true"
        [templateWithContext]="{ template: tooltipContent, context: { $implicit: threshold } }"
        [hideDelay]="2000"
        [classes]="[ 'fusion-ui-linear-gauge__threshold-tooltip', 'fusion-ui-linear-gauge__threshold-tooltip--' + (threshold?.level | getFusionUiStatusLevelText: null:true) ]">
      </button>

      <div
        class="fusion-ui-linear-gauge__value-bar"
        [ngStyle]="{ 'width' : value | percentage: maxValue:minValue:true | percent }"
        [ngClass]="{
          'fusion-ui-linear-gauge__value-bar--base' : level === FusionUiStatusLevel.BASE,
          'fusion-ui-linear-gauge__value-bar--normal' : level === FusionUiStatusLevel.NORMAL,
          'fusion-ui-linear-gauge__value-bar--warning' : level === FusionUiStatusLevel.WARNING,
          'fusion-ui-linear-gauge__value-bar--error' : level === FusionUiStatusLevel.ERROR,
          'fusion-ui-linear-gauge__value-bar--critical' : level === FusionUiStatusLevel.CRITICAL
        }">
      </div>
    </div>

    <div class="fusion-ui-linear-gauge__total">
      {{ !!valueFormatPipeItem ? (maxValue | meta:[valueFormatPipeItem]) : (!!dataFormatPipeItem ? (maxValue | meta:[dataFormatPipeItem]) : maxValue) }}
      <br />
      {{ translations?.total }}
    </div>

  </div>

  <div class="fusion-ui-linear-gauge__percentage">
    {{ !!valueFormatPipeItem ? (value | meta:[valueFormatPipeItem]) : (!!dataFormatPipeItem ? (value | meta:[dataFormatPipeItem]) : value) }}
    ({{ value | percentage: maxValue:minValue:false | percent }})
    {{ translations?.used }}
  </div>

</div>

<ng-template #tooltipContent let-threshold>
  <div class="fusion-ui-linear-gauge__tooltip-content">
    <h4 class="fusion-ui-linear-gauge__threshold-tooltip-title fusion-ui-h4" *ngIf="threshold?.title">{{ threshold?.title }}</h4>
    <p class="fusion-ui-linear-gauge__threshold-tooltip-level-and-value fusion-ui-p-md">
      <span class="fusion-ui-linear-gauge__threshold-tooltip-level">{{ threshold?.level | getFusionUiStatusLevelText: translations }}</span>: 
      <span class="fusion-ui-linear-gauge__threshold-tooltip-value">{{ !!dataFormatPipeItem ? (threshold?.value | meta:[dataFormatPipeItem]) : threshold?.value }}</span>
    </p>
  </div>
</ng-template>
